<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>消息通知</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="format-detection" content="telephone=no, email=no" />
        <meta http-equiv="Cache-Control" content="no-transform" />
        <meta http-equiv="Cache-Control" content="no-siteapp" /> 
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <link rel="shortcut icon" href="./images/favicon.ico?v=1.0" type="image/x-icon" />
        <link rel="stylesheet" href="css/pc.css?v=1.2" />
    </head>
    
    
    <body>
 		
        <!--头部 start-->
    	<div class="header f_pr">
        	<div class="header_inner f_cf f_pr">
            
            	<h1 class="logo f_fl"><a href="index.html" class="f_full f_db f_two">知客网</a></h1>
                
                <div class="center_title f_tac f_fl">消息通知</div>
                
                <div class="nav_search f_fl">
                
                    <div class="search_box f_fr">
                    	<form action="search_result.html" class="f_full f_pr">
                        	<label class="for_text" for="keyword">想要找点什么</label>
                            <input type="text" class="keyword placeholder f_fl" id="keyword"/>
                            <input type="button" class="search_btn f_fr" value="搜索"/>
                        </form>
                    </div>
                    
                	<ul class="f_fl"></ul>
                    
                </div>
                <div class="l_r f_pa">
                	<div class="no_login "><a href="javascript:;" class="js_login_pop f_dib">登录</a><i class="f_dib"></i><a href="javascript:;" class="js_register_pop  f_dib">注册</a></div>
                    <div class="logined f_dn">
                    	<div class="f_dib f_vat name_man_head">
                    		<div class="man_head f_pr f_dib"><img src="images/weixin.png" class="f_vart"/><div class="head_mask f_pa"></div><div class="message_info f_pa"></div></div>
                        	<span class="f_dib f_toe name f_vat"></span>
                            <span class="f_dn f_toe name f_vat my_home_page_a" data-type="pc_home.html">我的主页</span>
                            <div class="pc_dropDown f_pa f_dn">
                            	<div class="pc_dropDown_inner">
                                    <a href="pc_home.html">个人中心</a>
                                    <a href="pc_message.html">消息通知<i class="f_dib message_num">76</i></a>
                                    <a href="pc_public.html">发表文章</a>
                                    <a href="pc_my_hall.html">我的名人堂</a>
                                    <a href="pc_personal_info.html">账户设置</a>
                                    <a href="javascript:;" class="js_logout">退出</a>
                                </div>
                            </div>
                        </div>
                    	<a href="pc_public.html" class="writing f_dib">写文章</a>
                    </div>
                </div>
                <div class="mobile_nav f_pa f_dn"><div class="mobile_ico f_pa"></div><div class="mobile_mask f_pa"></div></div>
            </div>
        </div>
        <!--头部   end-->
        
        
        <!--主内容  start-->
        <div class="main_content f_pr loading" data-type="pc_newest_message"> 
        	<div class="main_contnet_inner f_pr "> 
            
            	<!--最新消息  start-->
            	<div class="pc_home_page"> 
                    <!--最新消息对应展示容器  start-->
                    <div class="pc_message_show_list">
                        <ul class="pc_message_list"></ul>
                        <div class="pc_load_more_data f_dn">查看更多</div>
                    </div>
                    <!--最新消息对应展示容器    end-->
                </div>
                <!--最新消息    end-->
            
            </div>
        </div>
        <!--主内容    end-->
        
        <!--底部 start-->
        <div class="footer f_pr">
        	<div class="footer_inner f_pr f_cf">
            	<div class="link_qrcode f_cf">
                    <dl class="f_fl">
                        <dt>ZAEKE</dt>
                        <dd class="f_toe"><a href="">加入我们</a></dd>
                        <dd class="f_toe"><a href="">商务合作</a></dd>
                        <dd class="f_toe"><a href="">用户协议</a></dd>
                    </dl>
                    <dl class="f_fl">
                        <dt>合作伙伴</dt>
                        <dd class="f_toe"><a href="">速致</a></dd>
                        <dd class="f_toe"><a href="">知客数码</a></dd>
                    </dl>
                    <dl class="f_fl">
                        <dt>试用介绍</dt>
                        <dd class="f_toe"><a href="">试用方式</a></dd>
                        <dd class="f_toe"><a href="">试用流程</a></dd>
                        <dd class="f_toe"><a href="">试用须知</a></dd>
                    </dl>
                    <dl class="f_fl">
                        <dt>友情链接</dt>
                        <dd class="f_toe"><a href="">充电头网</a></dd>
                        <dd class="f_toe"><a href="">TCL 手机铁粉俱乐部</a></dd>
                        <dd class="f_toe"><a href="">站长之家</a></dd>
                        <dd class="f_toe"><a href="">机智猫</a></dd>
                    </dl>
                    <ul class="f_fr">
                        <li><p>知客、让数码更懂你</p></li>
                        <li><img src="images/qrcode.png" class="f_vat"/></li>
                    </ul>
                </div>
                <div class="web_info f_cf">
                	<div class="big_logo_us_info f_fl">
                        <div class="big_logo f_fl"></div>
                        <div class="about_us_info f_fr">
                            <p>关于我们</p>
                            <div class="des">知客数码致力于打造数码玩家一站式完美体验的平台。我们希望能给每一位热爱数码的玩家，提供一个展示自己的平台。</div>
                            <div class="email_tel"><span class="f_dib f_vat mobile">13049894061</span><span class="f_dib f_vat email">chenwei@zaeke.com</span></div>
                        </div>
                    </div>
                    <div class="other_platform f_fr">
                    	<p>其他平台账号</p>
                        <div class="other_platform_list"><div class="l_qq f_dib"></div><div class="l_weixin f_dib"></div><div class="l_weibo f_dib"></div></div>
                    </div>
                </div>
            </div>
        </div>
        <!--底部   end-->
        
        
        
        <script src="js/jquery.min.1.8.3.js?v=1.7"></script>
        <script src="js/pc_common.js?v=1.2"></script>
        <script>		
			$(function(){
					
				//站内消息列表
				var loadLock=false,
					imgRoute="./",
					pageIndex=0,
					pageNum=10,
					url=golbalIp+"/user/message_list";
				function loadFunData(index){
					var paramLen=arguments.length;
					if(!loadLock){
						loadLock=true;
						$.ajax({
							url:url,
							type:"get",
							dataType:"json",
							data:{"account":JSON.parse($.cookie('bz')).account,"token":JSON.parse($.cookie('bz')).token,"skipnum":pageIndex,"length":pageNum},
							beforeSend:function(){},
							success:function(data){
								if(data.code==1){//数据请求成功
									var html="";
										$.each(data.data.list,function(i,item){
											var img="",nickName="知客数码",index=2;

											if(item.where_member_info){
												img=item.where_member_info.img;
												img=(img) ? ((img.substr(0,7).toLowerCase()=="http://" || img.substr(0,8).toLowerCase()=="https://") ? img : golbalIp+img) : imgRoute+"images/head_sculpture.png";
											}else {
												img=imgRoute+"images/head_sculpture.png";
											}
											if(item.where_member_id && item.where_member_info){
												nickName=item.where_member_info.nickname;
												index=1;
											}
											html+='<li>';
											html+='<div class="pc_head_name_time_opera f_cf">';
											html+='	<div class="pc_head f_fl f_ofh"><img src="'+img+'" class="f_vat"/></div>';
											html+='	<div class="pc_name_time f_fl">';
											html+='		<div class="pc_time">'+units.getDateDiff(item.created*1000)+'</div>';
											html+='		<div class="pc_name " data-type='+index+'><i class="jump_personal_info" data-author_id="'+item.member_id+'">'+nickName+'</i><span class="f_dn">回复了我的评论</span><b class="f_dn">给您发来了一条信息</b></div>';
											html+='	</div>';
											html+='	<div class="pc_delete f_fr" data-id="'+item.id+'">删除</div>';
											html+='</div>';
											html+='<div class="pc_author_comment f_wwb"><a href="javascript:;" data-id="'+item.id+'">'+item.message+'</a></div>';
/*											if(item.reply_comment!==undefined && item.reply_comment!==null){
												html+='<div class="pc_article_comment_list">';
												html+='	<dl class="pc_article_des">';
													$.each(item.reply_comment,function(a,subItem){
														html+='		<dd class="f_wwb">'+subItem.message+'</dd>';
													})
												html+='	</dl>';
												html+='</div>';
											}*/
											html+='</li>';	
										});
										if(paramLen==0){
											$(".pc_message_list").html(html);
											$(".main_content").removeClass("loading");
										}else {
											$(".pc_message_list").append(html);
										}
											
											
										//请求页码递增
										if(data.data.list.length<pageNum || data.data.total==pageNum){
											pageIndex=pageIndex;
											$(".pc_load_more_data").addClass("f_dn")	
										}else {
											pageIndex+=pageNum;
											var remain=data.data.total>=pageIndex ? data.data.total-pageIndex : 0;
											$(".pc_load_more_data").html("查看更多（"+remain+"）").removeClass("f_dn");
											if(remain==0){$(".pc_load_more_data").addClass("f_dn");}
										}
											
									}else if(data.code==3){
										if(paramLen!=1){
											alert("登录超时，请重新登录！");
										}
									}else {
										alert(data.message);
									}
									loadLock=false;
							},
							error:function(){alert("网络错误，请刷新重试！");loadLock=false;}
						});
					}
				};
				loadFunData();
										
				//加载更多数据
				$(".pc_load_more_data").on("click",function(){
					//判断是否登录有效
					variable_obj.logined();
					loadFunData(1);
				});											
										
				//删除消息
				root.deleteComment=false;
				$(".pc_message_list").on("click",function(e){
					var target=$(e.target);
						if(target.hasClass("pc_delete")){
							if($.cookie('bz')===undefined || $.trim($.cookie('bz'))==="" || ((new Date().getTime()/1000-JSON.parse($.cookie('bz')).updated) > 3600)){
								alert("您未登录或者登录超时，请重新登录后操作！");
								return false;	
							}else {
								if(!root.deleteComment){
									root.deleteComment=true;
									var state=window.confirm("确定删除该消息？");
										if(state){
											$.ajax({
												url:golbalIp+"/user/delete_message",
												type:"post",
												dataType:"json",
												data:{"account":JSON.parse($.cookie('bz')).account,"token":JSON.parse($.cookie('bz')).token,"id":target.attr("data-id")},
												beforeSend:function(){},
												success:function(data){
													if(data.code==1){
														target.parents("li").remove();
													}else {
														alert(data.message);
													}
													root.deleteComment=!1;
												},error:function(){
													alert("网络错误，请稍后再试！");
													root.deleteComment=!1;
												}
											});
									}
								}
							}
						}
				});
							
							
				
				//打开信息
				$(".pc_home_page").on("click",".pc_author_comment a ",function(){
					var id=$(this).attr("data-id"),t=this;
						if(!$(t).parents(".pc_author_comment").hasClass("readed")){
							$.ajax({
								url:golbalIp+"/user/message_detail",
								type:"get",
								dataType:"json",
								data:{"account":JSON.parse($.cookie('bz')).account,"token":JSON.parse($.cookie('bz')).token,"id":id},
								success:function(data){
									if(data.code==1){
										$(t).parents(".pc_author_comment").addClass("readed");
									}else {
										alert(data.message);	
									}
								},
								error:function(){}
							});
						}
				});

																	
														
				
			})
        </script>
        
        
    </body>
    
</html>